<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор военных действий</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: "DM Sans", sans-serif;
        }
        
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .box {
            width: 90%;
            max-width: 1200px;
            height: auto;
            min-height: 600px;
            margin: 0 auto;
            background-color: #B7C1C3;
            border-radius: 20px;
            box-shadow: 15px 13px 26px 0px rgba(0,0,0,0.73);
            padding: 20px;
        }
        
        .columns-container {
            display: flex;
            flex-wrap: nowrap;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .input_v1 {
            width: 100%;
            margin-top: 10px;
            height: 30px;
            border: 1px solid #CCD6D8;
            border-radius: 10px;
            padding: 5px 10px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .input-label {
            font-size: 12px;
            color: #34495e;
            margin-top: 8px;
            margin-bottom: 2px;
            display: block;
        }
        
        .column1 {
            width: 30%;
            padding-right: 15px;
        }
        
        .column2 {
            width: 45%;
            padding: 0 15px;
        }
        
        .column3 {
            width: 25%;
            padding-left: 15px;
        }
        
        .button {
            width: 100%;
            height: 40px;
            background-color: #747f81;
            border-radius: 20px;
            border: none;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 10px 9px 35px 1px rgba(0,0,0,0.75);
            transition: all 0.3s ease;
        }
        
        .button:hover {
            background-color: #5a6668;
            transform: translateY(-2px);
        }
        
        .result_block {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 15px;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            height: fit-content;
            min-height: 200px;
        }
        
        .result-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        
        .weather-info {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
            color: white;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .army-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .army-block {
            width: 48%;
            background: white;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .army-block.your {
            border-left: 4px solid #27ae60;
        }
        
        .army-block.enemy {
            border-left: 4px solid #e74c3c;
        }
        
        .army-name {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .army-power {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .losses-info {
            background: #ffe6e6;
            border-left: 4px solid #ff6b6b;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .support-info {
            background: #e8f5e8;
            border-left: 4px solid #4ecdc4;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .stat-line {
            margin: 5px 0;
            font-size: 13px;
        }
        
        .winner {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-top: 15px;
        }
        
        .no-results {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 50px 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            border: 2px dashed #bdc3c7;
        }
        
        .guide-block {
            padding: 15px;
            color: #2c3e50;
            background: linear-gradient(135deg, #e8f5e8 0%, #d4f1d4 100%);
            border-radius: 15px;
            margin-top: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            font-size: 11px;
        }
        
        .guide-title {
            font-size: 14px;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #27ae60;
            padding-bottom: 5px;
        }
        
        .guide-item {
            margin-bottom: 10px;
        }
        
        .guide-item strong {
            color: #27ae60;
        }
        
        .guide-desc {
            font-size: 10px;
            margin-left: 15px;
            line-height: 1.3;
        }
        
        .weather-effects {
            margin-bottom: 8px;
        }
        
        .weather-effects strong {
            color: #3498db;
        }
        
        .tip {
            font-size: 10px;
            color: #7f8c8d;
            line-height: 1.3;
        }

        /* Медиа-запросы для адаптивности */
        @media (max-width: 720px) {
            body {
                padding: 10px;
            }
            
            .box {
                width: 95%;
                padding: 15px;
                border-radius: 15px;
            }
            
            .columns-container {
                flex-direction: column;
                flex-wrap: wrap;
            }
            
            .column1, .column2, .column3 {
                width: 100%;
                padding: 0;
                margin-bottom: 20px;
            }
            
            /* Порядок колонок: ввод данных, подсказка, результаты */
            .column1 {
                order: 1;
            }
            
            .column3 {
                order: 2;
            }
            
            .column2 {
                order: 3;
            }
            
            .input_v1 {
                height: 35px;
                font-size: 16px; /* Увеличиваем шрифт для лучшего взаимодействия на мобильных */
                margin-top: 8px;
            }
            
            .button {
                height: 45px;
                font-size: 18px;
                margin-top: 15px;
            }
            
            /* Уменьшаем содержимое подсказки */
            .guide-block {
                padding: 12px;
                font-size: 10px;
                margin-top: 0;
            }
            
            .guide-title {
                font-size: 13px;
                margin-bottom: 10px;
            }
            
            .guide-item {
                margin-bottom: 8px;
            }
            
            .guide-desc {
                font-size: 9px;
                margin-left: 10px;
            }
            
            .weather-effects {
                margin-bottom: 6px;
            }
            
            .tip {
                font-size: 9px;
            }
            
            /* Скрываем часть подробной информации в подсказке на мобильных */
            .mobile-hide {
                display: none;
            }
            
            /* Результаты */
            .result_block {
                min-height: 150px;
                padding: 12px;
                margin-top: 0;
            }
            
            .result-title {
                font-size: 16px;
            }
            
            .army-stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .army-block {
                width: 100%;
            }
            
            .weather-info {
                font-size: 14px;
                padding: 8px;
            }
            
            .winner {
                font-size: 16px;
                padding: 12px;
            }
            
            .no-results {
                padding: 30px 15px;
            }
            
            .no-results div:first-child {
                font-size: 36px !important;
            }
        }
        
        @media (max-width: 480px) {
            .box {
                width: 98%;
                padding: 12px;
            }
            
            .input_v1 {
                font-size: 14px;
            }
            
            .button {
                font-size: 16px;
            }
            
            .guide-block {
                font-size: 9px;
                padding: 10px;
            }
            
            .guide-title {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="box">
        <div class="columns-container">
            <div class="column1">
                <input id="your_name" class="input_v1" placeholder="Название вашей страны:" type="text">
                <input id="target_name" class="input_v1" placeholder="Название страны противника:" type="text">
                <input id="your_army" class="input_v1" placeholder="Численность вашей армии:" type="number">
                <input id="target_army" class="input_v1" placeholder="Численность армии противника:" type="number">
                <input id="your_wwp" class="input_v1" placeholder="Ваш ВВП (млрд $):" type="number">
                <input id="target_wwp" class="input_v1" placeholder="ВВП противника (млрд $):" type="number">
                <select id="time_of_year" class="input_v1">
                    <option value="">Выберите время года</option>
                    <option value="Зима">Зима</option>
                    <option value="Весна">Весна</option>
                    <option value="Лето">Лето</option>
                    <option value="Осень">Осень</option>
                </select>
                <input id="your_resourses" class="input_v1" placeholder="Ваше снабжение (1-10):" type="number" min="1" max="10" >
                <input id="target_resourses" class="input_v1" placeholder="Снабжение противника (1-10):" type="number" min="1" max="10" >
                <input id="fortress" class="input_v1" placeholder="Укрепления противника (0-10):" type="number" min="0" max="10" >
            </div>
            <div class="column3">
                <div style="background: #e8f5e8; border-radius: 15px; padding: 15px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); margin-bottom: 10px;">
                    <div style="font-weight:bold; color:#27ae60; text-align:center; margin-bottom:10px;">Параметры техники</div>
                    <div style="margin-bottom:8px; color:#34495e;">Ваша сторона:</div>
                    <input id="your_fighters" class="input_v1" placeholder="Ваши истребители:" type="number">
                    <input id="your_bombers" class="input_v1" placeholder="Ваши бомбардировщики:" type="number">
                    <input id="your_navy" class="input_v1" placeholder="Ваш флот (корабли):" type="number">
                    <input id="your_aa" class="input_v1" placeholder="Ваши ПВО (ед.):" type="number">
                    <input id="your_tanks" class="input_v1" placeholder="Ваши танки:" type="number">
                    <div style="margin:12px 0 8px 0; color:#e74c3c;">Противник:</div>
                    <input id="target_fighters" class="input_v1" placeholder="Истребители противника:" type="number">
                    <input id="target_bombers" class="input_v1" placeholder="Бомбардировщики противника:" type="number">
                    <input id="target_navy" class="input_v1" placeholder="Флот противника (корабли):" type="number">
                    <input id="target_aa" class="input_v1" placeholder="ПВО противника (ед.):" type="number">
                    <input id="target_tanks" class="input_v1" placeholder="Танки противника:" type="number">
                </div>
            </div>
            <div class="column2">
                <div class="result_block" id="result_block">
                    <div class="result-title">Результаты сражения</div>
                    <div id="result_content">
                        <div class="no-results">
                            <div style="font-size: 48px; margin-bottom: 15px;">⚔️</div>
                            <div>Нажмите "Начать сражение" чтобы увидеть результаты боя</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button class="button" onclick="fun1()">Начать сражение</button>
    </div>

    <script>
        // Конфигурация погодных условий
        const weatherConfig = {
            1: { name: "Дождь", armyModifier: 0.87, techModifier: 0.85 },
            2: { name: "Ливень", armyModifier: 0.7, techModifier: 0.73 },
            3: { name: "Ясно", armyModifier: 1, techModifier: 1 },
            4: { name: "Туман", armyModifier: 0.85, techModifier: 0.75 },
            5: { name: "Снег", armyModifier: 0.80, techModifier: 0.7 },
            6: { name: "Метель", armyModifier: 0.65, techModifier: 0.6 }
        };

        // Конфигурация сезонных модификаторов
        const seasonConfig = {
            "Зима": { armyModifier: 0.8, techModifier: 0.7, weatherOptions: 6 },
            "Весна": { armyModifier: 0.9, techModifier: 0.87, weatherOptions: 4 },
            "Лето": { armyModifier: 1.1, techModifier: 1, weatherOptions: 4 },
            "Осень": { armyModifier: 0.9, techModifier: 0.9, weatherOptions: 4 }
        };

        // Функция для форматирования числа с пробелами
        function formatNumberWithSpaces(x) {
            if (typeof x !== "string") x = String(x);
            return x.replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        }

        // Функция для обработки ввода и форматирования числа с пробелами
        function handleNumberInput(e) {
            // Форматируем только если поле type="text" или type="number" и оно не для названия страны
            if (
                (e.target.type === "number" || e.target.type === "text") &&
                !e.target.id.includes('name') &&
                !e.target.id.includes('time_of_year')
            ) {
                let value = e.target.value.replace(/\s/g, '');
                if (value === '') {
                    e.target.value = '';
                    return;
                }
                // Только числа
                value = value.replace(/[^\d]/g, '');
                // Сохраняем позицию курсора
                let selectionStart = e.target.selectionStart;
                let oldLength = e.target.value.length;
                e.target.value = formatNumberWithSpaces(value);
                // Восстанавливаем позицию курсора (чтобы не прыгал)
                let newLength = e.target.value.length;
                e.target.selectionEnd = selectionStart + (newLength - oldLength);
            }
        }

        // Навешиваем обработчик на все числовые input'ы (кроме названий)
        window.addEventListener('DOMContentLoaded', function() {
            // Только для числовых полей (исключая названия)
            const inputs = document.querySelectorAll('input.input_v1');
            inputs.forEach(input => {
                if (
                    !input.id.includes('name') &&
                    !input.id.includes('time_of_year')
                ) {
                    input.type = "text"; // Меняем тип на text, чтобы не было ограничений браузера
                    input.addEventListener('input', handleNumberInput);
                }
            });
        });

        // Функция для получения числового значения из input с пробелами
        function getNumberValue(id) {
            let val = document.getElementById(id).value.replace(/\s/g, '');
            return val ? +val : 0;
        }

        function fun1() {
            let y_name = document.getElementById("your_name").value || "Ваша страна";
            let t_name = document.getElementById("target_name").value || "Противник";

            let y_army = getNumberValue("your_army");
            let t_army = getNumberValue("target_army");

            // Новые параметры
            let y_fighters = getNumberValue("your_fighters");
            let y_bombers = getNumberValue("your_bombers");
            let y_navy = getNumberValue("your_navy");
            let y_aa = getNumberValue("your_aa");
            let y_tanks = getNumberValue("your_tanks");

            let t_fighters = getNumberValue("target_fighters");
            let t_bombers = getNumberValue("target_bombers");
            let t_navy = getNumberValue("target_navy");
            let t_aa = getNumberValue("target_aa");
            let t_tanks = getNumberValue("target_tanks");

            let y_wwp = getNumberValue("your_wwp");
            let t_wwp = getNumberValue("target_wwp");
            let time_of_year = document.getElementById("time_of_year").value;

            let y_resourses = getNumberValue("your_resourses");
            let t_resourses = getNumberValue("target_resourses");
            let fortress = getNumberValue("fortress");

            // Проверка на выбор времени года
            if (!time_of_year) {
                const resultBlock = document.getElementById("result_block");
                const resultContent = document.getElementById("result_content");
                
                resultBlock.style.border = "3px solid #e74c3c";
                resultContent.innerHTML = `
                    <div style="text-align: center; color: #e74c3c; font-size: 18px; font-weight: bold; padding: 50px 20px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">⚠️</div>
                        <div>Вы не выбрали время года</div>
                    </div>
                `;
                return;
            }

            // Убираем красную рамку если время года выбрано
            const resultBlock = document.getElementById("result_block");
            resultBlock.style.border = "none";

            // Сохраняем изначальные значения для отображения
            let original_y_army = y_army;
            let original_t_army = t_army;
            // Исправлено: определяем оригинальные значения для новых параметров
            let original_y_fighters = y_fighters;
            let original_y_bombers = y_bombers;
            let original_y_navy = y_navy;
            let original_y_aa = y_aa;
            let original_y_tanks = y_tanks;
            let original_t_fighters = t_fighters;
            let original_t_bombers = t_bombers;
            let original_t_navy = t_navy;
            let original_t_aa = t_aa;
            let original_t_tanks = t_tanks;

            // Получаем погодные условия
            const season = seasonConfig[time_of_year];
            const weatherIndex = Math.floor(Math.random() * season.weatherOptions) + 1;
            const weather = weatherConfig[weatherIndex];

            // Применяем погодные модификаторы
            y_army *= weather.armyModifier;
            t_army *= weather.armyModifier;

            // Новые параметры под погодные модификаторы
            let y_fighters_weather = y_fighters * weather.techModifier;
            let y_bombers_weather = y_bombers * weather.techModifier;
            let y_navy_weather = y_navy * weather.techModifier;
            let y_aa_weather = y_aa * weather.techModifier;
            let y_tanks_weather = y_tanks * weather.techModifier;

            let t_fighters_weather = t_fighters * weather.techModifier;
            let t_bombers_weather = t_bombers * weather.techModifier;
            let t_navy_weather = t_navy * weather.techModifier;
            let t_aa_weather = t_aa * weather.techModifier;
            let t_tanks_weather = t_tanks * weather.techModifier;

            // Применяем сезонные модификаторы
            y_army *= season.armyModifier;
            t_army *= season.armyModifier;

            y_fighters_weather *= season.techModifier;
            y_bombers_weather *= season.techModifier;
            y_navy_weather *= season.techModifier;
            y_aa_weather *= season.techModifier;
            y_tanks_weather *= season.techModifier;

            t_fighters_weather *= season.techModifier;
            t_bombers_weather *= season.techModifier;
            t_navy_weather *= season.techModifier;
            t_aa_weather *= season.techModifier;
            t_tanks_weather *= season.techModifier;

            // Применяем бонусы от укреплений
            let fortress_bonus = 1 + (fortress * 0.055);
            t_army *= fortress_bonus;

            // Применяем бонусы от снабжения
            let y_supply_bonus = 1 + (y_resourses * 0.055);
            let t_supply_bonus = 1 + (t_resourses * 0.055);

            y_army *= y_supply_bonus;
            t_army *= t_supply_bonus;

            y_fighters_weather *= y_supply_bonus;
            y_bombers_weather *= y_supply_bonus;
            y_navy_weather *= y_supply_bonus;
            y_aa_weather *= y_supply_bonus;
            y_tanks_weather *= y_supply_bonus;

            t_fighters_weather *= t_supply_bonus;
            t_bombers_weather *= t_supply_bonus;
            t_navy_weather *= t_supply_bonus;
            t_aa_weather *= t_supply_bonus;
            t_tanks_weather *= t_supply_bonus;

            // Взаимодействие и влияние разных видов войск
            // Пример: истребители уменьшают эффективность бомбардировщиков противника, ПВО уменьшает эффективность авиации противника, флот влияет на флот и авиацию, танки эффективны против армии и техники
            // Можно добавить больше логики по желанию

            // Влияние ПВО на авиацию противника
            let y_aviation_penalty = Math.min(0.5, t_aa_weather * 0.01); // до -50%
            let t_aviation_penalty = Math.min(0.5, y_aa_weather * 0.01);

            // Влияние истребителей на бомбардировщики противника
            let y_bomber_penalty = Math.min(0.5, t_fighters_weather * 0.015); // до -50%
            let t_bomber_penalty = Math.min(0.5, y_fighters_weather * 0.015);

            // Влияние флота друг на друга
            let navy_diff = y_navy_weather - t_navy_weather;
            let y_navy_bonus = navy_diff > 0 ? Math.min(0.2, navy_diff * 0.01) : 0;
            let t_navy_bonus = navy_diff < 0 ? Math.min(0.2, -navy_diff * 0.01) : 0;

            // Итоговая сила каждого вида войск с учетом взаимодействий
            let y_fighters_power = y_fighters_weather * 25 * (1 - y_aviation_penalty);
            let y_bombers_power = y_bombers_weather * 35 * (1 - y_bomber_penalty - y_aviation_penalty);
            let y_navy_power = y_navy_weather * 40 * (1 + y_navy_bonus);
            let y_aa_power = y_aa_weather * 8;
            let y_tanks_power = y_tanks_weather * 15;

            let t_fighters_power = t_fighters_weather * 25 * (1 - t_aviation_penalty);
            let t_bombers_power = t_bombers_weather * 35 * (1 - t_bomber_penalty - t_aviation_penalty);
            let t_navy_power = t_navy_weather * 40 * (1 + t_navy_bonus);
            let t_aa_power = t_aa_weather * 8;
            let t_tanks_power = t_tanks_weather * 15;

            // Логирование влияния и взаимодействия в консоль
            console.log('Влияние и взаимодействие войск (ваша сторона):');
            console.log('Истребители:', y_fighters, '=>', y_fighters_weather.toFixed(2), '=>', y_fighters_power.toFixed(2), '| штраф от ПВО:', (y_aviation_penalty*100).toFixed(1)+'%');
            console.log('Бомбардировщики:', y_bombers, '=>', y_bombers_weather.toFixed(2), '=>', y_bombers_power.toFixed(2), '| штраф от ПВО:', (y_aviation_penalty*100).toFixed(1)+'%', '| штраф от истребителей:', (y_bomber_penalty*100).toFixed(1)+'%');
            console.log('Флот:', y_navy, '=>', y_navy_weather.toFixed(2), '=>', y_navy_power.toFixed(2), '| бонус:', (y_navy_bonus*100).toFixed(1)+'%');
            console.log('ПВО:', y_aa, '=>', y_aa_weather.toFixed(2), '=>', y_aa_power.toFixed(2));
            console.log('Танки:', y_tanks, '=>', y_tanks_weather.toFixed(2), '=>', y_tanks_power.toFixed(2));
            console.log('Суммарно:', (y_fighters_power + y_bombers_power + y_navy_power + y_aa_power + y_tanks_power).toFixed(2));

            console.log('Влияние и взаимодействие войск (противник):');
            console.log('Истребители:', t_fighters, '=>', t_fighters_weather.toFixed(2), '=>', t_fighters_power.toFixed(2), '| штраф от ПВО:', (t_aviation_penalty*100).toFixed(1)+'%');
            console.log('Бомбардировщики:', t_bombers, '=>', t_bombers_weather.toFixed(2), '=>', t_bombers_power.toFixed(2), '| штраф от ПВО:', (t_aviation_penalty*100).toFixed(1)+'%', '| штраф от истребителей:', (t_bomber_penalty*100).toFixed(1)+'%');
            console.log('Флот:', t_navy, '=>', t_navy_weather.toFixed(2), '=>', t_navy_power.toFixed(2), '| бонус:', (t_navy_bonus*100).toFixed(1)+'%');
            console.log('ПВО:', t_aa, '=>', t_aa_weather.toFixed(2), '=>', t_aa_power.toFixed(2));
            console.log('Танки:', t_tanks, '=>', t_tanks_weather.toFixed(2), '=>', t_tanks_power.toFixed(2));
            console.log('Суммарно:', (t_fighters_power + t_bombers_power + t_navy_power + t_aa_power + t_tanks_power).toFixed(2));

            // 1. Считаем силу армии до поддержки населения
            let y_base_power = y_army + y_fighters_power + y_bombers_power + y_navy_power + y_aa_power + y_tanks_power;
            let t_base_power = t_army + t_fighters_power + t_bombers_power + t_navy_power + t_aa_power + t_tanks_power;

            // 2. Находим слабую сторону и применяем штраф
            let ratio = 0;
            let weaker = null;
            if (y_base_power > t_base_power && t_base_power > 0) {
                ratio = y_base_power / t_base_power;
                if (ratio > 1.5) weaker = 't';
            } else if (t_base_power > y_base_power && y_base_power > 0) {
                ratio = t_base_power / y_base_power;
                if (ratio > 1.5) weaker = 'y';
            }
            if (weaker === 'y') {
                y_base_power = Math.floor(y_base_power * 0.7);
            }
            if (weaker === 't') {
                t_base_power = Math.floor(t_base_power * 0.7);
            }

            // --- ВАЖНО: объявляем lossPercentage1/2 до использования ---
            let lossPercentage1 = (Math.random() * 5) + 10;
            let lossPercentage2 = (Math.random() * 5) + 10;
            // Увеличиваем потери для меньшей стороны в 4.6 раза (4 * 1.6 = 6.4)
            if (weaker === 'y') lossPercentage1 *= 6.4;
            if (weaker === 't') lossPercentage2 *= 6.4;

            // Дополнительные потери от плохой погоды
            const weatherLossPenalty = {
                "Снег": 3,
                "Метель": 7
            };
            if (weatherLossPenalty[weather.name]) {
                lossPercentage1 += weatherLossPenalty[weather.name];
                lossPercentage2 += weatherLossPenalty[weather.name];
            }

            // 3. Применяем бонус поддержки населения
            let y_population_support = 100;
            let t_population_support = 100;
            
            y_population_support -= lossPercentage1 * 2.5;
            t_population_support -= lossPercentage2 * 2.5;
            
            let y_gdp_support_penalty = 0;
            let t_gdp_support_penalty = 0;
            
            if (y_wwp < t_wwp) {
                let disadvantage_percent = ((t_wwp - y_wwp) / y_wwp) * 100;
                y_gdp_support_penalty = disadvantage_percent / 30;
                y_population_support -= y_gdp_support_penalty;
            }
            
            if (t_wwp < y_wwp) {
                let disadvantage_percent = ((y_wwp - t_wwp) / t_wwp) * 100;
                t_gdp_support_penalty = disadvantage_percent / 30;
                t_population_support -= t_gdp_support_penalty;
            }
            
            y_population_support = Math.max(0, y_population_support);
            t_population_support = Math.max(0, t_population_support);

            let y_support_bonus = y_population_support / 100;
            let t_support_bonus = t_population_support / 100;
            
            let y_a_army = Math.floor(y_base_power * (1 + y_support_bonus));
            let t_a_army = Math.floor(t_base_power * (1 + t_support_bonus));

            // 4. Теперь считаем потери как процент от итоговой силы
            let losses1 = Math.round((lossPercentage1 / 100) * y_a_army);
            let losses2 = Math.round((lossPercentage2 / 100) * t_a_army);

            // Определяем победителя
            let winner = y_a_army > t_a_army ? y_name : 
                        t_a_army > y_a_army ? t_name : "Ничья";

            // --- ОПРЕДЕЛЯЕМ ПЕРЕМЕННЫЕ ДЛЯ ВВП-ШТРАФА ---
            let y_gdp_penalty = false;
            let t_gdp_penalty = false;
            let gdp_ratio_y = y_wwp / t_wwp;
            let gdp_ratio_t = t_wwp / y_wwp;
            if (gdp_ratio_t >= 1.2) {
                y_gdp_penalty = true;
            }
            if (gdp_ratio_y >= 1.2) {
                t_gdp_penalty = true;
            }

            // Старый вывод результатов
            displayResults({
                y_name, t_name, weather: weather.name, time_of_year,
                y_a_army, t_a_army,
                losses1, losses2, lossPercentage1, lossPercentage2,
                y_population_support, t_population_support,
                y_gdp_support_penalty, t_gdp_support_penalty,
                y_support_bonus, t_support_bonus,
                y_gdp_penalty, t_gdp_penalty,
                winner,
                original_y_army, original_t_army,
                fortress, y_resourses, t_resourses,
                original_y_fighters, original_y_bombers, original_y_navy, original_y_aa, original_y_tanks,
                original_t_fighters, original_t_bombers, original_t_navy, original_t_aa, original_t_tanks
            });
        }

        function displayResults(data) {
            const resultContent = document.getElementById("result_content");

            resultContent.innerHTML = `
                <div class="weather-info">
                    🌤️ Погода: ${data.weather} (${data.time_of_year})
                </div>

                <div class="army-stats">
                    <div class="army-block your">
                        <div class="army-name">${data.y_name}</div>
                        <div class="army-power">💪 ${formatNumberWithSpaces(data.y_a_army)}</div>
                        <div class="stat-line">Армия: ${formatNumberWithSpaces(data.original_y_army)}</div>
                        <div class="stat-line">Истребители: ${formatNumberWithSpaces(data.original_y_fighters || 0)}</div>
                        <div class="stat-line">Бомбардировщики: ${formatNumberWithSpaces(data.original_y_bombers || 0)}</div>
                        <div class="stat-line">Флот: ${formatNumberWithSpaces(data.original_y_navy || 0)}</div>
                        <div class="stat-line">ПВО: ${formatNumberWithSpaces(data.original_y_aa || 0)}</div>
                        <div class="stat-line">Танки: ${formatNumberWithSpaces(data.original_y_tanks || 0)}</div>
                        <div class="stat-line">Снабжение: ${formatNumberWithSpaces(data.y_resourses)}/10</div>
                    </div>
                    <div class="army-block enemy">
                        <div class="army-name">${data.t_name}</div>
                        <div class="army-power">💪 ${formatNumberWithSpaces(data.t_a_army)}</div>
                        <div class="stat-line">Армия: ${formatNumberWithSpaces(data.original_t_army)}</div>
                        <div class="stat-line">Истребители: ${formatNumberWithSpaces(data.original_t_fighters || 0)}</div>
                        <div class="stat-line">Бомбардировщики: ${formatNumberWithSpaces(data.original_t_bombers || 0)}</div>
                        <div class="stat-line">Флот: ${formatNumberWithSpaces(data.original_t_navy || 0)}</div>
                        <div class="stat-line">ПВО: ${formatNumberWithSpaces(data.original_t_aa || 0)}</div>
                        <div class="stat-line">Танки: ${formatNumberWithSpaces(data.original_t_tanks || 0)}</div>
                        <div class="stat-line">Укрепления: ${formatNumberWithSpaces(data.fortress)}/10</div>
                    </div>
                </div>
                
                <div class="losses-info">
                    <strong>💀 Потери в сражении:</strong><br>
                    ${data.y_name}: ${formatNumberWithSpaces(data.losses1)} (${data.lossPercentage1.toFixed(1)}%)<br>
                    ${data.t_name}: ${formatNumberWithSpaces(data.losses2)} (${data.lossPercentage2.toFixed(1)}%)
                </div>
                
                <div class="support-info">
                    <strong>👥 Поддержка населения:</strong><br>
                    ${data.y_name}: ${data.y_population_support.toFixed(1)}% 
                    ${data.y_gdp_support_penalty > 0 ? `(штраф: -${data.y_gdp_support_penalty.toFixed(1)}%)` : ''}<br>
                    ${data.t_name}: ${data.t_population_support.toFixed(1)}%
                    ${data.t_gdp_support_penalty > 0 ? `(штраф: -${data.t_gdp_support_penalty.toFixed(1)}%)` : ''}
                </div>
                
                <div class="support-info">
                    <strong>⚡ Бонусы к армии:</strong><br>
                    ${data.y_name}: +${(data.y_support_bonus * 100).toFixed(1)}% от поддержки
                    ${data.y_gdp_penalty ? ' | -10% от ВВП' : ''}<br>
                    ${data.t_name}: +${(data.t_support_bonus * 100).toFixed(1)}% от поддержки
                    ${data.t_gdp_penalty ? ' | -10% от ВВП' : ''}
                </div>
                
                <div class="winner">
                    🏆 Победитель: ${data.winner}
                </div>
            `;
        }
    </script>
</body>
</html>
